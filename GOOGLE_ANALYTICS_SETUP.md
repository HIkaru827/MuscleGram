# Google Analytics セットアップガイド

MuscleGramアプリにGoogle Analytics 4 (GA4)が統合されました。以下の手順で設定を完了してください。

## 1. Google Analytics 4の設定

### GA4プロパティの作成
1. [Google Analytics](https://analytics.google.com/)にアクセス
2. 「管理」→「プロパティを作成」
3. プロパティ名: `MuscleGram`
4. レポートのタイムゾーン: `日本`
5. 通貨: `日本円 (JPY)`

### 測定IDの取得
1. 「管理」→「データストリーム」
2. 「ストリームを追加」→「ウェブ」
3. ウェブサイトURL: `https://yourdomain.com`
4. ストリーム名: `MuscleGram Web`
5. **測定ID（G-XXXXXXXXXX）をコピー**

## 2. 環境変数の設定

### .env.localファイルを作成
```bash
# .env.local
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX
```

**重要**: 本番環境（Vercel/Netlifyなど）でも同じ環境変数を設定してください。

## 3. 実装されている機能

### 自動追跡イベント
- **ページビュー**: 全ページの閲覧
- **ワークアウト開始**: ライブ/手動記録モード
- **ワークアウト完了**: 時間、種目数、セット数
- **PR達成**: 種目別、改善率付き
- **フィルター使用**: 分析画面での絞り込み操作

### エラー追跡
- JavaScript エラー
- Promise rejection
- カテゴリ別分類

### コンバージョン追跡
- 初回ワークアウト
- 初回PR達成
- 初回投稿

## 4. プライバシー対応

### Cookie同意バナー
- 初回訪問時に表示
- 詳細設定が可能
- 必須Cookie/アナリティクスCookie/機能Cookie/マーケティングCookieを分類

### GDPR準拠
- ユーザーの明示的な同意
- 同意の撤回が可能
- データ最小化原則

## 5. 分析データの確認方法

### GA4ダッシュボードでの確認
1. **リアルタイム**: アクティブユーザーの確認
2. **イベント**: カスタムイベントの分析
3. **コンバージョン**: 重要なアクションの追跡
4. **ユーザー属性**: デモグラフィック情報

### 重要なイベント
- `workout_start`: ワークアウト開始
- `workout_complete`: ワークアウト完了
- `pr_achieved`: PR達成
- `exercise_added`: 種目追加
- `filter_usage`: フィルター使用

## 6. カスタムディメンション（推奨）

GA4でカスタムディメンションを設定すると、より詳細な分析が可能です：

1. **muscle_group**: 筋肉部位（胸、背中、脚など）
2. **exercise_name**: 種目名
3. **workout_mode**: 記録モード（live/manual）
4. **pr_type**: PRタイプ（e1RM、3RM、session_volumeなど）

### 設定方法
1. GA4「管理」→「カスタム定義」
2. 「カスタムディメンション」→「カスタムディメンションを作成」
3. 上記の項目を追加

## 7. 開発環境での確認

開発環境では実際のGA4には送信されず、コンソールにログが表示されます：

```javascript
// 開発環境でのログ例
GA Event (dev): { action: 'workout_start', category: 'fitness', label: 'mode_live' }
GA Page View (dev): { url: '/record', title: 'Record' }
```

## 8. トラブルシューティング

### イベントが記録されない場合
1. 環境変数が正しく設定されているか確認
2. ブラウザの開発者ツールでエラーをチェック
3. GA4のリアルタイムレポートで確認

### Cookie同意バナーが表示されない場合
1. ブラウザのローカルストレージをクリア
2. 初回訪問扱いにするため`cookieConsent`キーを削除

## 9. パフォーマンスへの影響

- 非同期読み込みによる影響最小化
- 開発環境では無効化
- ユーザー同意に基づく選択的読み込み

## 10. 今後の拡張予定

- eコマース追跡（PRO版の課金など）
- より詳細なユーザー行動分析
- A/Bテスト機能の統合